<!DOCTYPE HTML>
<html lang="zh-CN">

<head>
    <title></title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=0,user-scalable=no,minimal-ui">
    <meta http-equiv="Content-Type" content="text/html;charset=utf-8"/>
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black">
    <meta name="format-detection" content="telephone=no">
    <meta http-equiv="Expires" content="-1">
    <meta http-equiv="Cache-Control" content="no-cache">
    <meta http-equiv="Pragma" content="no-cache">
    <meta name="full-screen" content="yes">
    <meta name="browsermode" content="application">
    <meta name="x5-fullscreen" content="true">
    <meta name="x5-page-mode" content="app">
    <meta name="keywords" content="">
    <meta name="description" content="">
    <script src="./js/flexible.min.js"></script>
    <link rel="stylesheet" href="./js/vue/index.css"/>
    <link rel="stylesheet" href="./css/register/index.css">
</head>
<body>
<div id="app">
    <div class="register">
        <div class="head row verCenter rowCenter">
            <img src="images/register/logo.png">
        </div>
        <div class="form-box">
            <div class="inp-wrap row verCenter">
                <i class="iconfont iconicondanseshouji"></i>
                <input type="text" placeholder="请输入注册手机号码" class="inp" v-model="form.Mobile"/>
            </div>
            <div class="inp-wrap row verCenter bothSide">
                <div class="row verCenter">
                    <i class="iconfont iconicondanseshouji1"></i>
                    <input type="text" placeholder="请输入短信验证码" class="inp" v-model="form.ValidCode"/>
                </div>
                <div>
                    <input type="button" class="code" :value="codetext" :class="{'disabled':codeactive}" :disabled="disabled" @click="codeFn"/>
                </div>
            </div>
            <div class="inp-wrap row verCenter bothSide">
                <div class="row rowCenter">
                    <i class="iconfont iconicondanseshouji11"></i>
                    <input :type="type" placeholder="请设置6-20位登录密码" class="inp" v-model="form.Pwd"/>
                </div>
                <van-switch v-model="checked" size="24" @change="change"></van-switch>
            </div>
            <div class="inp-wrap row verCenter">
                <i class="iconfont iconicondanseshouji11"></i>
                <input :type="type" placeholder="请两次确认登录密码" class="inp" v-model="form.PwdConfirm"/>
            </div>
            <div class="agreement row verCenter">
                <div class="gou row rowCenter verCenter" :class="agreement ? '':'gouactive'" @click="agreement=!agreement">
                    <i class="iconfont iconbianzu"></i>
                </div>
                <p class="txt">
                    <span>同意</span>
                    <a href="/agreement.html">《猎板网用户服务协议》</a>
                </p>
            </div>
            <a href="javascript:;" class="btn" @click="submit()">注册</a>
        </div>
        <div class="activity">
            <div class="title">
                <b class="l"></b>
                <b class="r"></b>
                <em class="l"></em>
                <em class="r"></em>
                <span>活动</span>
            </div>
            <div class="ad row rowCenter verCenter">广告位</div>
        </div>
    </div>
</div>

<script src="./js/vue/vue.min.js"></script>
<script src="./js/vue/axios.min.js"></script>
<script src="./js/vue/vant.min.js"></script>
<script src="./js/util.js"></script>
<script>

  var apiUrl = 'http://111.231.8.26:5000'; //测试
  //var apiUrl = 'https://test.pcbhunt.com'; //预发

  axios.defaults.headers.post['Content-Type'] = 'application/json';


  new Vue({
    el: '#app',
    data: {
      agreement: true,
      type: 'password',
      checked: false,
      codetext: '发送验证码',
      disabled: false,
      codeactive: false,
      c: '',
      form: {
        Mobile: '',
        ValidCode: '',
        Pwd: '',
        PwdConfirm: '',
        WebPromotion: '',
        WebSource: ''
      }
    },
    created() {

      //注册来源  15天缓存
      var c = Util.getRequest('c');

      if (c) {
        if (!Util.getCookie('WebPromotion')) {
          Util.setCookie('WebPromotion', c, 15);
        }
      }


    },
    methods: {
      timeNum() {

        var me = this;
        var wait = 60;
        me.disabled = true;
        me.codeactive = true;
        me.codetext = wait + '秒后获取';
        var clock = setInterval(doLoop, 1000);

        function doLoop() {
          wait--;
          if (wait > 0) {
            me.codetext = wait + '秒后获取';
            me.codeactive = true;
          } else {
            clearInterval(clock);
            me.disabled = false;
            me.codeactive = false;
            me.codetext = '重新获取';
            wait = 60;
          }
        }
      },
      codeFn() {
        var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;

        if (!this.form.Mobile) {
          vant.Toast('请输入手机号');
          return false;
        }

        if (!myreg.test(this.form.Mobile)) {
          vant.Toast('请输入正确的手机号');
          return false;
        }

        axios.post(apiUrl + '/api/MemberShip/SendValidCode', {
          'Mobile': this.form.Mobile
        }).then((data) => {
          let res = data.data;

          if (res.Code === 200) {
            this.timeNum();
          } else {
            vant.Toast(res.Message);
          }
        }).catch(function (error) {
          vant.Toast('网络出现问题，请重试！');
        });


      },
      change(val) {
        if (val) {
          this.type = 'text';
        } else {
          this.type = 'password';
        }
      },
      submit() {

        var myreg = /^[1][3,4,5,7,8][0-9]{9}$/;

        if (!this.form.Mobile) {
          vant.Toast('请输入手机号');
          return false;
        }

        if (!myreg.test(this.form.Mobile)) {
          vant.Toast('请输入正确的手机号');
          return false;
        }

        if (!this.form.ValidCode) {
          vant.Toast('请输入短信验证码');
          return false;
        }

        if (!this.form.Pwd) {
          vant.Toast('请输入密码');
          return false;
        }

        if (!this.form.PwdConfirm) {
          vant.Toast('请再次输入密码');
          return false;
        }

        if (!this.agreement) {
          vant.Toast('请同意协议继续');
          return false;
        }


        axios.post(apiUrl + '/api/MemberShip/MinARegister', {
          'Mobile': this.form.Mobile,
          'Pwd': this.form.Pwd,
          'PwdConfirm': this.form.PwdConfirm,
          'ValidCode': this.form.ValidCode,
          'WebPromotion': Util.getCookie('WebPromotion'),
          'WebSource': this.form.WebSource
        }).then((data) => {
          let res = data.data;
          if (res.Code === 200) {
            Toast.success('注册成功');
            setTimeout(() => {
              window.location.href = '/regSuccess.html'
            }, 2000)
          } else {
            vant.Toast(res.Message);
          }
        }).catch(function (error) {
          vant.Toast('网络出现问题，请重试！');
        });


      }
    }
  });
</script>
</body>
</html>
